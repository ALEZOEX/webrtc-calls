<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–í–∏–¥–µ–æ –ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è</title>

  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üé•</text></svg>">

  <!-- –°—Ç–∏–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
  <link rel="stylesheet" href="/style.css" />

  <!-- –ò–∫–æ–Ω–∫–∏ Font Awesome -->
  <!-- ‚úÖ Font Awesome —Å fallback -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
    onerror="this.onerror=null;this.href='https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css';"
  />
</head>
<body>
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–æ–º–Ω–∞—Ç–µ -->
  <header class="header">
    <div class="logo">
      <h3>üé• Video Conference</h3>
    </div>
    <div class="room-info">
      <i class="fas fa-door-open"></i>
      <span>–ö–æ–º–Ω–∞—Ç–∞:</span>
      <code id="room-code"><%= roomId.substring(0, 8) %>...</code>
    </div>
  </header>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏ -->
  <main class="main">
    <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –≤–∏–¥–µ–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ -->
    <section class="main__left">
      <!-- –ó–æ–Ω–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —ç–∫—Ä–∞–Ω–∞ -->
      <div id="screen-share-zone" class="screen-share-zone"></div>

      <!-- –°–µ—Ç–∫–∞ –≤–∏–¥–µ–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ -->
      <div id="participants-grid" class="participants-grid"></div>

      <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–µ–π -->
      <div class="control-panel">
        <button id="stopVideo" class="control-button" title="–ö–∞–º–µ—Ä–∞">
          <i class="fas fa-video-slash"></i>
        </button>
        <button id="muteButton" class="control-button" title="–ú–∏–∫—Ä–æ—Ñ–æ–Ω">
          <i class="fas fa-microphone"></i>
        </button>
        <button id="screenShareButton" class="control-button" title="–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∞">
          <i class="fas fa-desktop"></i>
        </button>
        <button id="inviteButton" class="control-button" title="–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å">
          <i class="fas fa-user-plus"></i>
        </button>
        <button id="raiseHandBtn" class="control-button" title="–ü–æ–¥–Ω—è—Ç—å —Ä—É–∫—É">
          <i class="fas fa-hand-paper"></i>
        </button>
        <button id="moderationBtn" class="control-button" title="–ú–æ–¥–µ—Ä–∞—Ü–∏—è">
          <i class="fas fa-user-shield"></i>
        </button>
        <button id="recordBtn" class="control-button" title="–ó–∞–ø–∏—Å—å –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏">
          <i class="fas fa-record-vinyl"></i>
        </button>
        <div class="dropdown-container">
          <button id="qualityBtn" class="control-button" title="–ö–∞—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ">
            <i class="fas fa-video"></i>
          </button>
          <div id="qualityDropdown" class="dropdown-content" style="display: none; position: absolute; background: #2c2c2c; min-width: 160px; box-shadow: 0 8px 16px rgba(0,0,0,0.5); z-index: 1; border-radius: 6px; padding: 10px; bottom: 50px; left: -60px;">
            <button id="qualityLow" class="quality-option">–ù–∏–∑–∫–æ–µ (320p)</button>
            <button id="qualityMedium" class="quality-option">–°—Ä–µ–¥–Ω–µ–µ (480p)</button>
            <button id="qualityHigh" class="quality-option">–í—ã—Å–æ–∫–æ–µ (720p)</button>
            <button id="qualityUltra" class="quality-option">–°–≤–µ—Ä—Ö–≤—ã—Å–æ–∫–æ–µ (1080p)</button>
          </div>
        </div>
        <button id="toggleChat" class="control-button" title="–ß–∞—Ç">
          <i class="fas fa-comments"></i>
        </button>
        <button id="exit-conference-btn" class="control-button danger" title="–í—ã–π—Ç–∏">
          <i class="fas fa-phone-slash"></i>
        </button>
      </div>
    </section>

    <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å —Å —á–∞—Ç–æ–º -->
    <section class="main__right" id="chat-panel">
      <div class="chat-panel">
        <h3>üí¨ –ß–∞—Ç</h3>
        <div class="messages"></div>
        <div class="chat-input-container">
          <input id="chat_message" type="text" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off" maxlength="500" />
          <button id="send" class="chat-send-button">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>
        <div class="emoji-buttons">
          <button class="emoji-button" data-emoji="‚ù§Ô∏è">‚ù§Ô∏è</button>
          <button class="emoji-button" data-emoji="üëç">üëç</button>
          <button class="emoji-button" data-emoji="üëé">üëé</button>
          <button class="emoji-button" data-emoji="üòÇ">üòÇ</button>
          <button class="emoji-button" data-emoji="üò±">üò±</button>
          <button class="emoji-button" data-emoji="üòé">üòé</button>
          <button class="emoji-button" data-emoji="üéâ">üéâ</button>
          <button class="emoji-button" data-emoji="üëè">üëè</button>
        </div>
      </div>
    </section>
  </main>

  <!-- –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è WebRTC —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ -->
  <!-- Socket.IO –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è -->
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

  <!-- Simple Peer –¥–ª—è WebRTC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π -->
  <script src="https://unpkg.com/simple-peer@9.11.0/simplepeer.min.js"></script>

  <!-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –∫–æ–º–Ω–∞—Ç—ã -->
  <script>
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ—á–∏—Å—Ç–∫–∞ roomId
    const RAW_ROOM_ID = "<%= roomId %>";
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ roomId —Å–æ—Å—Ç–æ–∏—Ç —Ç–æ–ª—å–∫–æ –∏–∑ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
    const roomId = /^[a-zA-Z0-9_-]+$/.test(RAW_ROOM_ID) ? RAW_ROOM_ID : 'invalid-room';

    // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL
    const urlParams = new URLSearchParams(window.location.search);
    const isPrivate = urlParams.get('private') === 'true';
    const password = urlParams.get('password');
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

    console.log('üîß ID –∫–æ–º–Ω–∞—Ç—ã:', roomId);
    console.log('üîí –ü—Ä–∏–≤–∞—Ç–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞:', isPrivate);
  </script>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
  <script src="/script.js"></script>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ -->
  <div id="moderationModal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);">
    <div class="modal-content" style="background-color: #1a1a1a; margin: 15% auto; padding: 20px; border: 1px solid #3a3a3a; border-radius: 8px; width: 60%; color: white;">
      <h3>üîê –ú–æ–¥–µ—Ä–∞—Ü–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</h3>
      <div id="participantsList" class="participants-list">
        <!-- –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω —Å–∫—Ä–∏–ø—Ç–æ–º -->
      </div>
      <div class="modal-actions" style="margin-top: 20px; display: flex; justify-content: flex-end; gap: 10px;">
        <button id="closeModerationModal" class="btn">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>
</body>
</html>